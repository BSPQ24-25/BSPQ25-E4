<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title data-en="Vehicle Management" data-fr="Gestion des Véhicules" data-es="Gestión de Vehículos">Vehicle Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .container {
            width: 90%;
            max-width: 1200px;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            background-color: white;
            border: 1px solid #ddd;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #ddd;
        }

        .action-btn {
            margin-right: 10px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            text-decoration: none;
            cursor: pointer;
            font-size: 0.9em;
        }

        .edit-btn {
            background-color: #2196F3;
            color: white;
        }

        .delete-btn {
            background-color: #f44336;
            color: white;
        }

        .vehicle-form-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
        }

        .vehicle-form-table td {
            padding: 8px;
        }

        .vehicle-form-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .vehicle-form-table button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .vehicle-form-table button:hover {
            background-color: #45a049;
        }

        .table-scroll-container {
            overflow-x: auto;
        }

        /* Style for Back button */
        .btn-back {
            background-color: red;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
            margin-top: 20px;
            display: inline-block;
            text-align: center;
        }

        .btn-back:hover {
            background-color: darkred;
        }

        #langSelect {
            width: 150px;
            margin-bottom: 10px;
            display: block;
        }
    </style>
</head>
<body>
<div class="container">
    <select id="langSelect">
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="es">Español</option>
    </select>

    <h1 data-en="Vehicle Management" data-fr="Gestion des Véhicules" data-es="Gestión de Vehículos">Vehicle Management</h1>

    <form id="searchForm" style="margin-bottom: 20px;">
        <label for="searchField" data-en="Search by:" data-fr="Rechercher par :" data-es="Buscar por:">Search by:</label>
        <select id="searchField">
            <option value="brand" data-en="Brand" data-fr="Marque" data-es="Marca">Brand</option>
            <option value="model" data-en="Model" data-fr="Modèle" data-es="Modelo">Model</option>
            <option value="color" data-en="Color" data-fr="Couleur" data-es="Color">Color</option>
            <option value="transmission" data-en="Transmission" data-fr="Transmission" data-es="Transmisión">Transmission</option>
            <option value="status" data-en="Status" data-fr="Statut" data-es="Estado">Status</option>
            <option value="fuelLevel" data-en="Fuel Level" data-fr="Niveau de Carburant" data-es="Nivel de Combustible">Fuel Level</option>
            <option value="mileage" data-en="Mileage" data-fr="Kilométrage" data-es="Kilometraje">Mileage</option>
            <option value="manufacturingYear" data-en="Manufacturing Year" data-fr="Année de Fabrication" data-es="Año de Fabricación">Manufacturing Year</option>
            <option value="insuranceId" data-en="Insurance ID" data-fr="ID d'Assurance" data-es="ID de Seguro">Insurance ID</option>
        </select>
        <input type="text" id="searchValue" placeholder="Enter value..." required data-en="Enter value..." data-fr="Entrez une valeur..." data-es="Ingrese un valor..." />
        <button type="submit" data-en="Search" data-fr="Rechercher" data-es="Buscar">Search</button>
    </form>

    <form th:action="@{/admin/vehicles/add}" method="post">
        <div class="table-scroll-container">
            <table class="vehicle-form-table">
                <tr>
                    <td><input type="text" name="brand" placeholder="Brand" required data-en="Brand" data-fr="Marque" data-es="Marca"></td>
                    <td><input type="text" name="model" placeholder="Model" required data-en="Model" data-fr="Modèle" data-es="Modelo"></td>
                    <td><input type="text" name="color" placeholder="Color" required data-en="Color" data-fr="Couleur" data-es="Color"></td>
                    <td><input type="number" step="0.1" min="0" name="fuelLevel" placeholder="Fuel Level" required data-en="Fuel Level" data-fr="Niveau de Carburant" data-es="Nivel de Combustible"></td>
                    <td><input type="text" name="transmission" placeholder="Transmission" required data-en="Transmission" data-fr="Transmission" data-es="Transmisión"></td>
                    <td><input type="text" name="status" placeholder="Status" required data-en="Status" data-fr="Statut" data-es="Estado"></td>
                    <td><input type="number" step="0.1" min="0" name="mileage" placeholder="Mileage" required data-en="Mileage" data-fr="Kilométrage" data-es="Kilometraje"></td>
                    <td><input type="number" min="1960" name="manufacturingYear" placeholder="Year" required data-en="Year" data-fr="Année" data-es="Año"></td>
                    <td><input type="number" name="insuranceId" placeholder="Insurance ID" required data-en="Insurance ID" data-fr="ID d'Assurance" data-es="ID de Seguro"></td>
                    <td><button type="submit" data-en="Add Vehicle" data-fr="Ajouter un Véhicule" data-es="Agregar Vehículo">Add Vehicle</button></td>
                </tr>
            </table>
        </div>
    </form>

    <table>
        <thead>
        <tr>
            <th data-en="ID" data-fr="ID" data-es="ID">ID</th>
            <th data-en="Brand" data-fr="Marque" data-es="Marca">Brand</th>
            <th data-en="Model" data-fr="Modèle" data-es="Modelo">Model</th>
            <th data-en="Color" data-fr="Couleur" data-es="Color">Color</th>
            <th data-en="Fuel Level" data-fr="Niveau de Carburant" data-es="Nivel de Combustible">Fuel Level</th>
            <th data-en="Transmission" data-fr="Transmission" data-es="Transmisión">Transmission</th>
            <th data-en="Status" data-fr="Statut" data-es="Estado">Status</th>
            <th data-en="Mileage" data-fr="Kilométrage" data-es="Kilometraje">Mileage</th>
            <th data-en="Year" data-fr="Année" data-es="Año">Year</th>
            <th data-en="Insurance ID" data-fr="ID d'Assurance" data-es="ID de Seguro">Insurance ID</th>
            <th data-en="Edit" data-fr="Modifier" data-es="Editar">Edit</th>
            <th data-en="Delete" data-fr="Supprimer" data-es="Eliminar">Delete</th>
        </tr>
        </thead>
        <tbody id="vehicleTableBody">
        </tbody>
    </table>

    <a href="/admin/dashboard" class="btn-back" data-en="Back" data-fr="Retour" data-es="Volver">Back</a>
</div>

<script>
    const langSelect = document.getElementById('langSelect');
    const translatableElements = document.querySelectorAll('[data-en]');

    function translatePage(lang) {
        translatableElements.forEach(element => {
            const translation = element.dataset[lang];
            if (translation) {
                element.textContent = translation;
            }
        });

        // Translate placeholder attributes
        const inputPlaceholders = document.querySelectorAll('input[placeholder][data-en]');
        inputPlaceholders.forEach(input => {
            const translation = input.dataset[lang];
            if (translation) {
                input.placeholder = translation;
            }
        });
    }

    langSelect.addEventListener('change', function() {
        const selectedLang = this.value;
        translatePage(selectedLang);
        localStorage.setItem('currentLang', selectedLang);
    });

    // Load previously selected language
    const storedLang = localStorage.getItem('currentLang');
    if (storedLang) {
        langSelect.value = storedLang;
        translatePage(storedLang);
    } else {
        // Set default language if not stored
        translatePage('en');
    }

    const renderVehicles = (vehicles) => {
        const tableBody = document.getElementById("vehicleTableBody");
        tableBody.innerHTML = '';
        vehicles.forEach(vehicle => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${vehicle.id}</td>
                <td>${vehicle.brand}</td>
                <td>${vehicle.model}</td>
                <td>${vehicle.color}</td>
                <td>${vehicle.fuelLevel}</td>
                <td>${vehicle.transmission}</td>
                <td>${vehicle.status}</td>
                <td>${vehicle.mileage}</td>
                <td>${vehicle.manufacturingYear}</td>
                <td>${vehicle.insuranceId ? vehicle.insuranceId : 'N/A'}</td>
                <td><a href="/admin/vehicles/edit/${vehicle.id}" class="action-btn edit-btn" data-en="Edit" data-fr="Modifier" data-es="Editar">Edit</a></td>
                <td><form action="/admin/vehicles/delete/${vehicle.id}" method="post" style="display:inline;">
                        <button type="submit" class="action-btn delete-btn"
                            onclick="return confirm(this.getAttribute('data-confirm'))"
                            data-en="Delete" data-fr="Supprimer" data-es="Eliminar"
                            data-confirm-en="Are you sure you want to delete this vehicle?"
                            data-confirm-fr="Êtes-vous sûr de vouloir supprimer ce véhicule ?"
                            data-confirm-es="¿Está seguro de que desea eliminar este vehículo?">Delete</button>
                    </form>
                </td>`;
            tableBody.appendChild(row);

            // Translate the confirmation message for the delete button
            const deleteButton = row.querySelector('.delete-btn');
            deleteButton.addEventListener('click', function(event) {
                const currentLang = localStorage.getItem('currentLang') || 'en';
                const confirmMessage = this.getAttribute(`data-confirm-${currentLang}`);
                if (!confirm(confirmMessage)) {
                    event.preventDefault();
                }
            });
        });
        translatePage(localStorage.getItem('currentLang') || 'en'); // Ensure table content is also translated on re-render
    };

    document.getElementById('searchForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const field = document.getElementById('searchField').value;
        const value = document.getElementById('searchValue').value;
        const response = await fetch(`/api/cars/search?field=${field}&value=${encodeURIComponent(value)}`);
        const data = await response.json();
        renderVehicles(data);
    });

    window.addEventListener('DOMContentLoaded', async () => {
        const response = await fetch('/api/cars');
        const data = await response.json();
        renderVehicles(data);
    });
</script>
</body>
</html>